# Домашнее задание 5

## 1. Загрузка картинок и обработка AJAX запросов

Целью домашнего задания является добавления функционала аватарок (загрузка картинок) и обработка AJAX запросов (лайки).

## 2. Срок сдачи

ДЗ3, ДЗ4, ДЗ5 нужно сдать к семинару, на котором выдается ДЗ6. Работы, отправленные на проверку позже, оцениваются в половину максимальных баллов.

До начала занятия, на котором выдается ДЗ6, необходимо:
- пройти ревью у ментора (в формате PR в репозитории) и внести правки;
- передать работу на финальную проверку преподавателям.


## 3. Загрузка картинок
Для хранения картинок нужно использовать встроенные инструменты Django, а именно [django.db.models.ImageField](https://docs.djangoproject.com/en/5.0/ref/models/fields/#imagefield) для хранения URL картинки в модели и [django.forms.ImageField](https://docs.djangoproject.com/en/5.0/ref/models/fields/#imagefield) для описания поля в форме. Django хранит загруженные файлы на диске в директории **settings.MEDIA_ROOT**. В нашем случае в настройке **settings.MEDIA_URL** и в конфиге nginx должен быть прописать путь к директории **media** вашего проекте. Для отображения аватарки пользователя достаточно будет вставить в тег **\<img src="{{ MEDIA_URL }}{{ user.avatar }}"\>**.

## 4. Необходимыe AJAX запросы
- Лайк/дизлайк вопроса. На сервер передаются параметры: id вопроса, тип (лайк / дизлайк). Возвращается: новый рейтинг вопроса или код ошибки.
- Лайк/дизлайк ответа. На сервер передаются параметры: id ответа, тип (лайк / дизлайк). Возвращается: новый рейтинг ответа или код ошибки.
- Галочка правильный ответ. На сервер передается ID вопроса и ID правильного ответа. Необходимо проверить, что только автор вопроса может выбирать правильный ответ.

## 5. Обработка AJAX запросов
Так как отображение ошибок при AJAX запросах затруднительно, желательно не дать (на уровне интерфейса) возможности пользователю делать неправильные запросы. Например, если пользователь уже лайкал данный вопрос - то скрыть или отключить кнопку лайка. Скрыть выбор правильного ответа для не авторов.

В отличие от остальных страниц, в ответ на AJAX запрос сервер должен возвращать JSON документ. Для этого необходимо создавать объект **django.http.HttpResponse** самостоятельно с **Content-Type: application/json** и соответсвующим телом ответа, либо воспользоваться вспомогательным [объектом django.http.JsonResponse](https://docs.djangoproject.com/en/5.0/ref/request-response/#jsonresponse-objects).

Для отправки AJAX запросов в браузере можно использовать [jQuery](https://api.jquery.com/jquery.ajax/).
Необходимо учесть, что Django ожидает получить с каждым запросом [csrf_token](https://docs.djangoproject.com/en/5.0/howto/csrf/#using-csrf-protection-with-ajax), поэтому необходимо добавить его в данные каждого AJAX запроса.

## 6. Баллы

### Максимальные баллы за ДЗ - 11 баллов

Загрузка и отображение аватарок пользователей - 4 балла
- Аватарка загружается через форму профиля и сохраняется в MEDIA_ROOT (не в STATIC_ROOT) — 1
- Валидация файла на бэкенде: есть ограничение на расширения и размеру (ошибки показываются пользователю) — 1
- Пути к файлам неперебираемые (имя файла не должно быть предсказуемым; используется upload_to и/или генерация уникальных имён) — 1
- Отображение аватарки на сайте работает корректно, а пути к /media и /static задаются из конфигурации Django (через MEDIA_URL, STATIC_URL, настройки и шаблонные теги), есть обработка пустоты — 1

Лайки/дизлайки вопросов и ответов (AJAX) — 4 баллов
- Реализован лайк/дизлайк вопроса (валидация входных данных в форме, изменение оценки, возврат нового рейтинга) — 1
- Реализован лайк/дизлайк ответа (валидация входных данных в форме, изменение оценки, возврат нового рейтинга) — 1
- Есть проверка авторизация пользователя и соответствующая обработка на клиенте (клиентский login redirect или alert) — 1
- Есть клиентская обработка ошибок (неверный метод, отсутствие CSRF, невалидные параметры, повторный лайк и etc.) — 1

Отметка правильного ответа (AJAX) — 3 балла
- Реализована отметка правильного ответа (валидация входных данных в форме, изменение отметки, возврат обновленных данных) — 1
- Есть проверка авторизация пользователя и соответствующая обработка на клиенте (клиентский login redirect или alert) — 1
- Есть клиентская обработка ошибок (неверный метод, отсутствие CSRF, авторство, невалидные параметры, повторный лайк и etc.) — 1


### 7. Полезные ссылки
- Документация по [загрузке файлов в Django](https://docs.djangoproject.com/en/5.0/ref/forms/fields/#imagefield);
- Документация по [работе со статическими файлам в Django](https://docs.djangoproject.com/en/5.0/howto/static-files/);
- Неплохой туториал по [связке django + jquery + ajax](https://realpython.com/blog/python/django-and-ajax-form-submissions/);
- Про [CSRF в Django](https://docs.djangoproject.com/en/5.0/ref/csrf/).
