# Домашнее задание 2

## 1. Обработка HTTP запросов

Целью домашнего задания является:
- создание основных view сайта (отображающих “рыбу”);
- настройка маршрутизации URL;
- использование шаблонизатора для генерации HTML;
- постраничное отображение (пагинация);
- настройка рабочего окружения (нужно привести проект к состоянию, удобному для запуска и проверки на любой машине).

## 2. Срок сдачи

ДЗ1 и ДЗ2 нужно сдать к семинару, на котором выдается ДЗ3. Работы, отправленные на проверку позже, оцениваются в половину максимальных баллов.

До начала занятия, на котором выдается ДЗ3, необходимо:
- пройти ревью у ментора (в формате PR в репозитории) и внести правки;
- передать работу на финальную проверку преподавателям.

## 3. Настройка рабочего окружения

### 3.1. Файл requirements.txt

Создаем файл requirements.txt в корне репозитория и фиксируем зависимости проекта. Это нужно, чтобы любой человек (ментор/преподаватель) мог воспроизвести ваше окружение одной командой. Минимально в requirements.txt должен быть Django.

Обычно файл формируется командой:
```
pip freeze > requirements.txt
```

### 3.2. Обновление .gitignore под Django

Обновляем .gitignore, чтобы в репозиторий не попадали файлы, которые не должны храниться в Git.

Должны быть исключены (минимум):
- виртуальное окружение: `venv/`, `.venv/`
- python: `__pycache__/`, `*.pyc`
- Django: `db.sqlite3`, `*.sqlite3`, `media/` и `static/`
- IDE/OS: `.idea/`, `.vscode/`, `.DS_Store`
- переменные окружения: `.env`

Важное дополнение по .env:

Хотя сам файл `.env` мы скрываем, нужно создать файл **`.env.example`**.
1. Перенесите в него названия всех переменных из вашего `.env`.
2. Вместо реальных паролей и ключей поставьте заглушки (например, `DB_PASSWORD=password`).
3. Файл `.env.example` **нужно добавить в Git и закоммитить**. Это поможет понять, какие настройки нужны для запуска проекта, не раскрывая секреты.

### 3.3. Dockerfile (можно подготоить после основной части ДЗ2)

Добавляем Dockerfile для сборки образа с вашим Django-проектом (предварительно устанавливаем docker).

Требования:
- базовый образ Python (например python:3.12-slim);
- установка зависимостей из requirements.txt;
- копирование кода в контейнер;
- рабочая директория и команда запуска (через python manage.py runserver 0.0.0.0:8000).

### 3.4. Docker-compose (можно подготоить после основной части ДЗ2)

Добавляем docker-compose.yml для удобного запуска проекта.

Требования:
- сервис web (Django);
- проброс порта 8000:8000;
- volume с кодом проекта (чтобы изменения в файлах на хосте сразу отражались в контейнере);
- volume для media/, чтобы не терять загруженные файлы при пересборке.

Обновляем README, добавив команды для запуска проекта. Должны быть описаны оба варианта:
- локальный запуск (venv + pip install -r requirements.txt + python manage.py runserver);
- запуск через Docker Compose (docker compose up --build).

## 4. Создание django проекта и приложения
Разворачиваем в директории проекта python virtualenv ставим django.
С помощью утилиты django-admin (появляется после установки django) нужно создать следующую структуру:
```
EDU-Web                          - директория проекта в которой инициализован git
    |--- application             - директория с настройками settings.py
    |--- core                    - приложение с функционалом пользователя (страницы входа, регистрации, профиль) - ./manage.py startapp core
          |--- templates/core    - шаблоны для приложения core
          └--- static/core       - статика для приложения core
    |--- questions               - приложение с функционалом вопросов (страницы списка вопроса, вопроса, etc) - ./manage.py startapp questions
          |--- templates/core    - шаблоны для приложения questions
          └--- static/core       - статика для приложения questions
    |--- manage.py               - скрипт управления (будет создан django-admin.py)
    |--- static                  - папка для собранных статических файлов (JS, CSS, картинки)
    └--- media                   - папка для загруженных юзером файлов
```
При этом директории templates, static, uploads — придется создать самостоятельно.


## 5. Отображение данных
Разработать view для отображения следующих страниц:

- cписок новых вопросов (главная страница) (URL = **/**)
- cписок “лучших” вопросов (URL = **/hot/**)
- cписок вопросов по тэгу (URL = **/tag/blablabla/**)
- cтраница одного вопроса со списком ответов (URL = **/question/35/**)
- форма логина (URL = **/login/**)
- форма регистрации (URL = **/signup/**)
- форма редактирования профиля (URL = **/profile/**)
- форма создания вопроса (URL = **/ask/**)

На данном этапе view не обязаны выбирать данные из базы, их задача - подготовить данные-заглушки (“рыбу”) и передать на отрисовку в соответствующий шаблон. Например таким образом:
```Python
questions = []
for i in range(1,30):
  questions.append({
    ‘title’: ‘title ‘ + str(i),
    ‘id’: i,
    ‘text’: ‘text’ + str(i)
  })
```
Далее список **questions** можно будет легко заменить на выборку из базы данных. Views отображающие формы (например форму логина) - могут просто вызывать шаблон.

## 6. Маршрутизация URL
Для всех вышеперечисленных view нужно прописать маршруты в **app/urls.py** и подключить их в корневом **ask_pupkin/urls.py**. Все маршруты должны быть именованными.

## 7. Шаблонизация
Для каждой из вышеперечисленных view нужно создать отдельный шаблон, отрисовывающий HTML данной страницы. В шаблонах **не должно быть** дублирования HTML - для этого следует использовать наследование шаблонов и подшаблоны (include). В шаблонах должны быть прописаны гиперссылки для переходов на другие страницы. URL **не хардкодить**, вместо этого использовать тэг **url**. В шаблонах должны быть прописаны пути до файлов статики. Пути до файлов статики **не хардкодить**, вместо этого использовать тэг **static**.

## 8. Функция пагинации
Общим функционалом для этих страниц является пагинация. Поэтому функционал пагинации следует вынести в отдельную функцию, которая будет принимать список объектов (или **query-set**), объект запроса (**request**) и будет возвращать нужную страницу и данные для шаблона пагинатора. Некорректные параметры пагинации нужно заменять на значения по-умолчанию и необходимо обработать исключения [**PageNotAnInteger** и **EmptyPage**](https://docs.djangoproject.com/en/5.0/ref/paginator/#django.core.paginator.Paginator.page). Cигнатура функции должна быть следующей:

```Python
def paginate(objects_list, request, per_page=10):
    # do smth with Paginator, etc…
    return page
```

## 9. Баллы

### Максимальные баллы за ДЗ - 14 баллов

Создать views, urls и templates для основных страниц - 6 баллов
- главная (список новых вопросов), список популярных вопросов, список вопросов по тегу - 1;
- страница вопроса с списоком ответов - 1;
- страница добавления вопроса - 1;
- форма регистрации, входа и редактирования профиля  - 1;
- наличие urls.py и именованных маршруты (во всех шаблонах) - 1;
- проработанные шаблоны - наличие base.html и использование extends, отсутсвие копипасты блоков и использование includes, отсутсвие хардкода (URL на другие страницы, до файлов статики) - 1.

Постраничное отображение - 4 балла
- функция пагинации - 1;
- шаблон для отрисовки пагинатора - 2;
- корректная обработка “неправильных” параметров - 1.

Настроенное рабочее окружение - 4 балла
- наличие requirements.txt в корне репозитория — 1
- наличие .gitignore с исключениями для Django/Python/IDE — 1
- наличие Dockerfile (проект можно запустить в контейнере) — 1
- наличие docker-compose.yml + обновление README (теперь содержит команды запуска проекта в Docker) — 1

## 10. Полезные ссылки
- Туториал по [Django Views](https://docs.djangoproject.com/en/5.0/intro/tutorial03/);
- Документация по [шаблонам](https://docs.djangoproject.com/en/5.0/ref/templates/language/);
- [Наследование шаблонов](https://docs.djangoproject.com/en/5.0/ref/templates/language/#template-inheritance);
- [Постраничный вывод (пагинация)](https://docs.djangoproject.com/en/5.0/topics/pagination/).
